<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Items • Add to Cart</title>

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    :root { --brand: #0d6efd; }
    body { font-family: "DM Sans", system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#f7f8fb; }
    .navbar-brand { font-weight: 700; }
    .page { min-height: 100vh; display: flex; flex-direction: column; }

    /* Filter/search bar */
    .filter-bar { position: sticky; top: 0; z-index: 10; background: #fff; border-radius: .75rem; }

    /* Compact item cards */
    .item-card { border: 1px solid #eee; border-radius: 10px; transition: transform .15s ease, box-shadow .15s ease; height: 100%; background: #fff; }
    .item-card:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.06); }
    .item-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 10px 10px 0 0; }
    .card-body { padding: .7rem .8rem .9rem; }
    .card-title { font-size: .95rem; font-weight: 600; margin: 0 0 .15rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .price { font-weight: 700; font-size: .95rem; }
    .meta { font-size: .75rem; color: #6b7280; }
    .qty-wrap { display: inline-flex; align-items: center; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
    .qty-btn { width: 32px; height: 32px; display: inline-flex; align-items: center; justify-content: center; background: #f5f5f5; border: 0; }
    .qty-input { width: 40px; text-align: center; border: 0; outline: none; font-size: .85rem; }
    .add-btn { padding: 6px 10px; font-size: .82rem; }

    /* Sticky mobile cart bar */
    .cart-bar {
      position: sticky; bottom: 0; z-index: 20;
      background: #fff; border-top: 1px solid #eee;
      padding: .65rem .9rem; box-shadow: 0 -6px 20px rgba(0,0,0,.04);
    }

    /* Offcanvas cart */
    .offcanvas-header { border-bottom: 1px solid #efefef; }
    .cart-item + .cart-item { border-top: 1px dashed #e9ecef; }
  </style>
</head>
<body>
  <div class="page">
    <!-- Header -->
    <nav class="navbar bg-white border-bottom">
      <div class="container">
        <a class="navbar-brand text-dark" href="#"><i class="bi bi-basket2 me-2 text-primary"></i>Menu</a>
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-outline-secondary btn-sm d-lg-none" data-bs-toggle="offcanvas" data-bs-target="#cartDrawer" aria-label="Cart">
            <i class="bi bi-bag"></i>
          </button>
          <button class="btn btn-primary position-relative" data-bs-toggle="offcanvas" data-bs-target="#cartDrawer">
            <i class="bi bi-bag-check me-1"></i> Cart
            <span id="cartCountBadge" class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle">0</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Filters -->
    <div class="container my-3">
      <div class="filter-bar shadow-sm p-3">
        <div class="row g-2 align-items-center">
          <div class="col-12 col-md-6">
            <div class="input-group">
              <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
              <input id="searchInput" type="text" class="form-control" placeholder="Search items…" />
            </div>
          </div>
          <div class="col-6 col-md-3">
            <select id="categorySelect" class="form-select">
              <option value="all">All Categories</option>
              <option value="pizza">Pizza</option>
              <option value="beverages">Beverages</option>
              <option value="desserts">Desserts</option>
            </select>
          </div>
          <div class="col-6 col-md-3">
            <select id="sortSelect" class="form-select">
              <option value="popularity">Sort: Popularity</option>
              <option value="price-asc">Price: Low to High</option>
              <option value="price-desc">Price: High to Low</option>
              <option value="name-asc">Name: A → Z</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Items Grid -->
    <div class="container pb-5">
      <div id="itemsGrid" class="row g-3">
        <!-- Filled by JS -->
      </div>
    </div>

    <!-- Sticky Mobile Cart Bar -->
    <div class="cart-bar">
      <div class="container d-flex align-items-center justify-content-between">
        <div class="small text-secondary">Items: <span id="cartItemsCount">0</span></div>
        <div class="fw-bold">Subtotal: <span id="cartSubtotal">₹0.00</span></div>
        <button class="btn btn-primary btn-sm" data-bs-toggle="offcanvas" data-bs-target="#cartDrawer">
          View Cart
        </button>
      </div>
    </div>
  </div>

  <!-- Offcanvas Cart -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="cartDrawer" aria-labelledby="cartDrawerLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title fw-bold" id="cartDrawerLabel"><i class="bi bi-bag-check me-1"></i> Your Cart</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <div id="cartItems" class="flex-grow-1">
        <!-- Filled by JS -->
      </div>
      <div class="border-top pt-3">
        <div class="d-flex justify-content-between mb-2">
          <span class="text-secondary">Subtotal</span>
          <strong id="drawerSubtotal">₹0.00</strong>
        </div>
        <div class="d-grid gap-2">
          <button id="checkoutBtn" class="btn btn-primary btn-lg">Checkout</button>
          <button id="clearCartBtn" class="btn btn-outline-secondary">Clear Cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index:1080;">
    <div id="toast" class="toast align-items-center" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"></div>
        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* ------------ Demo Data (replace from API) ------------ */
    const PRODUCTS = [
      { id: 1,  name: "Margherita Pizza",   price: 199, category: "pizza",     popular: true,  img: "https://picsum.photos/seed/p1/600" },
      { id: 2,  name: "Farmhouse Pizza",    price: 329, category: "pizza",     popular: true,  img: "https://picsum.photos/seed/p2/600" },
      { id: 3,  name: "Veggie Supreme",     price: 289, category: "pizza",     popular: false, img: "https://picsum.photos/seed/p3/600" },
      { id: 4,  name: "Cold Coffee",        price: 120, category: "beverages", popular: true,  img: "https://picsum.photos/seed/p4/600" },
      { id: 5,  name: "Lemon Iced Tea",     price: 110, category: "beverages", popular: false, img: "https://picsum.photos/seed/p5/600" },
      { id: 6,  name: "Brownie Sundae",     price: 180, category: "desserts",  popular: true,  img: "https://picsum.photos/seed/p6/600" },
      { id: 7,  name: "Choco Lava Cake",    price: 150, category: "desserts",  popular: false, img: "https://picsum.photos/seed/p7/600" },
      { id: 8,  name: "Paneer Tikka Pizza", price: 349, category: "pizza",     popular: false, img: "https://picsum.photos/seed/p8/600" },
      { id: 9,  name: "Classic Mojito",     price: 130, category: "beverages", popular: true,  img: "https://picsum.photos/seed/p9/600" },
      { id: 10, name: "Cheesecake Slice",   price: 210, category: "desserts",  popular: false, img: "https://picsum.photos/seed/p10/600" },
    ];

    /* ------------ State ------------ */
    let cart = {}; // { id: { id, name, price, qty } }
    let filters = { q: "", category: "all", sort: "popularity" };

    /* ------------ Utils ------------ */
    const cur = n => "₹" + n.toFixed(2);
    const showToast = (msg) => {
      const el = document.getElementById('toast');
      el.querySelector('.toast-body').textContent = msg;
      new bootstrap.Toast(el).show();
    };
    const countItems = () => Object.values(cart).reduce((s, it) => s + it.qty, 0);
    const subtotal = () => Object.values(cart).reduce((s, it) => s + it.qty * it.price, 0);

    /* ------------ Render Products ------------ */
    function renderItems() {
      let items = [...PRODUCTS];

      // Search
      if (filters.q) {
        const q = filters.q.toLowerCase();
        items = items.filter(p => p.name.toLowerCase().includes(q));
      }
      // Category
      if (filters.category !== "all") items = items.filter(p => p.category === filters.category);
      // Sort
      if (filters.sort === "price-asc") items.sort((a,b)=>a.price-b.price);
      if (filters.sort === "price-desc") items.sort((a,b)=>b.price-a.price);
      if (filters.sort === "name-asc") items.sort((a,b)=>a.name.localeCompare(b.name));
      if (filters.sort === "popularity") items.sort((a,b)=>Number(b.popular)-Number(a.popular));

      const grid = document.getElementById('itemsGrid');
      grid.innerHTML = items.map(p => `
        <div class="col-6 col-md-4 col-lg-3">
          <div class="item-card h-100">
            <img src="${p.img}" alt="${p.name}" class="item-img">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0" title="${p.name}">${p.name}</h6>
                <div class="price text-primary">${cur(p.price)}</div>
              </div>
              <div class="meta mb-2 text-capitalize">${p.category}${p.popular ? " • Popular" : ""}</div>

              <div class="d-flex align-items-center gap-2">
                <div class="qty-wrap">
                  <button class="qty-btn" data-action="dec" data-id="${p.id}" aria-label="Decrease"><i class="bi bi-dash"></i></button>
                  <input id="qty-${p.id}" class="qty-input" type="number" min="1" value="1" aria-label="Quantity">
                  <button class="qty-btn" data-action="inc" data-id="${p.id}" aria-label="Increase"><i class="bi bi-plus"></i></button>
                </div>
                <button class="btn btn-primary add-btn flex-grow-1" data-action="add" data-id="${p.id}">
                  <i class="bi bi-cart-plus me-1"></i>Add
                </button>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    /* ------------ Render Cart ------------ */
    function renderCart() {
      const list = document.getElementById('cartItems');
      const items = Object.values(cart);
      const sub = subtotal();

      document.getElementById('cartCountBadge').textContent = countItems();
      document.getElementById('cartItemsCount').textContent = countItems();
      document.getElementById('cartSubtotal').textContent = cur(sub);
      document.getElementById('drawerSubtotal').textContent = cur(sub);

      if (items.length === 0) {
        list.innerHTML = `<div class="text-center text-secondary py-5">
          <i class="bi bi-bag fs-1 d-block mb-2"></i>No items in cart
        </div>`;
        return;
      }

      list.innerHTML = items.map(it => `
        <div class="cart-item py-3">
          <div class="d-flex align-items-start justify-content-between gap-3">
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h6 class="mb-1 fw-bold">${it.name}</h6>
                <div class="text-nowrap">${cur(it.price * it.qty)}</div>
              </div>
              <div class="text-secondary small mb-2">Unit: ${cur(it.price)}</div>

              <div class="d-flex align-items-center gap-2">
                <div class="qty-wrap">
                  <button class="qty-btn" data-action="cart-dec" data-id="${it.id}"><i class="bi bi-dash"></i></button>
                  <input class="qty-input" type="number" min="1" value="${it.qty}" data-action="cart-set" data-id="${it.id}"/>
                  <button class="qty-btn" data-action="cart-inc" data-id="${it.id}"><i class="bi bi-plus"></i></button>
                </div>
                <button class="btn btn-outline-danger btn-sm" data-action="remove" data-id="${it.id}">
                  <i class="bi bi-trash3"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    /* ------------ Add to Cart ------------ */
    function addToCart(productId, qty=1) {
      const p = PRODUCTS.find(x => x.id === productId);
      if (!p) return;
      if (!cart[productId]) cart[productId] = { id: p.id, name: p.name, price: p.price, qty: 0 };
      cart[productId].qty += qty;
      renderCart();
      showToast(`${p.name} added to cart`);
    }

    /* ------------ Event Delegation ------------ */
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const action = btn.dataset.action;
      const id = Number(btn.dataset.id);

      // Qty on product card
      if (action === 'inc' || action === 'dec') {
        const input = document.getElementById(`qty-${id}`);
        if (!input) return;
        let val = Number(input.value || 1);
        input.value = action === 'inc' ? val + 1 : Math.max(1, val - 1);
      }

      // Add
      if (action === 'add') {
        const input = document.getElementById(`qty-${id}`);
        const qty = Math.max(1, Number(input?.value || 1));
        addToCart(id, qty);
      }

      // Cart controls
      if (action === 'cart-inc' && cart[id]) { cart[id].qty += 1; renderCart(); }
      if (action === 'cart-dec' && cart[id]) { cart[id].qty = Math.max(1, cart[id].qty - 1); renderCart(); }
      if (action === 'remove') { delete cart[id]; renderCart(); }

      // Footer buttons
      if (btn.id === 'clearCartBtn') { cart = {}; renderCart(); showToast('Cart cleared'); }
      if (btn.id === 'checkoutBtn') {
        // Replace with your route
        showToast('Proceeding to checkout…');
        // window.location.href = '/checkout';
      }
    });

    // Change qty by typing in cart
    document.addEventListener('input', (e) => {
      const el = e.target;
      if (el.dataset.action === 'cart-set') {
        const id = Number(el.dataset.id);
        let v = Math.max(1, Number(el.value || 1));
        el.value = v;
        if (cart[id]) { cart[id].qty = v; renderCart(); }
      }
    });

    // Filters
    document.getElementById('searchInput').addEventListener('input', (e) => { filters.q = e.target.value.trim(); renderItems(); });
    document.getElementById('categorySelect').addEventListener('change', (e) => { filters.category = e.target.value; renderItems(); });
    document.getElementById('sortSelect').addEventListener('change', (e) => { filters.sort = e.target.value; renderItems(); });

    // Init
    renderItems();
    renderCart();
  </script>
</body>
</html>
